TP : Micro-service CQRS/Event Sourcing avec Spring Boot & Axonüìù Description du ProjetCe projet impl√©mente un micro-service bancaire de gestion de comptes en utilisant les patterns de conception Command Query Responsibility Segregation (CQRS) et Event Sourcing (ES).Command Side : Utilise les agr√©gats Axon pour traiter les commandes (CreateAccountCommand, CreditAccountCommand, DebitAccountCommand) et persiste les changements sous forme d'√©v√©nements dans l'Event Store (Axon Server).Query Side : Utilise des Event Handlers pour mettre √† jour une vue mat√©rialis√©e des comptes (projection) stock√©e dans une base de donn√©es relationnelle (H2).Communication : Axon Framework g√®re le routage des commandes/requ√™tes et la distribution des √©v√©nements via Axon Server.üõ†Ô∏è Pr√©requisPour lancer et tester l'application, les √©l√©ments suivants sont n√©cessaires :Java Development Kit (JDK) : Version 17+ (ou celle utilis√©e dans votre projet, g√©n√©ralement d√©finie dans votre IDE).Maven : Pour la gestion des d√©pendances et la construction du projet.Axon Server Standard Edition : Le serveur externe qui sert d'Event Store et de Routeur (fichier axonserver.jar).IDE : IntelliJ IDEA (recommand√©) ou Eclipse.üèóÔ∏è Structure du Projet (CQRS & DDD)Le projet est organis√© autour du package racine ma.enset.java.demoescqrsaxon, s√©parant clairement les responsabilit√©s Commandes et Requ√™tes.1. üü¢ Command Side (C√¥t√© √âcriture)PackageR√¥leClasses Cl√©s (Exemples)commandsRepr√©sente les intentions de changement d'√©tat.CreateAccountCommand, CreditAccountCommand.eventsLes faits immuables stock√©s apr√®s l'ex√©cution d'une commande.AccountCreatedEvent, AccountCreditedEvent.aggregatesLa logique centrale qui g√®re l'√©tat du compte (m√©thodes @CommandHandler et @EventSourcingHandler).AccountAggregate.commands.controllersInterface REST pour envoyer les commandes au bus Axon.AccountCommandController.dtosObjets de transfert pour la r√©ception des donn√©es des commandes.AddNewAccountRequestDTO.2. üîµ Query Side (C√¥t√© Lecture / Projection)PackageR√¥leClasses Cl√©s (Exemples)queriesLes requ√™tes pour lire l'√©tat actuel des donn√©es.GetAccountByIdQuery, GetAllAccountsQuery.query.entitiesLes entit√©s JPA (la vue mat√©rialis√©e) stock√©es dans la base H2.Account.query.repositoriesInterfaces Spring Data JPA pour l'acc√®s √† la projection.AccountRepository.query.servicesContient les m√©thodes @QueryHandler et @EventHandler pour maintenir et r√©pondre aux requ√™tes.AccountQueryHandler.‚öôÔ∏è Configuration du Projet1. D√©pendances Cl√©s (pom.xml)axon-spring-boot-starter : Int√©gration compl√®te d'Axon Framework.spring-boot-starter-data-jpa : N√©cessaire pour le Query Side (Projection).h2 : Base de donn√©es en m√©moire pour le Query Side.springdoc-openapi-starter-webmvc-ui : Pour l'interface de test Swagger UI.lombok : Pour la r√©duction du code passe-partout.2. Fichier application.propertiesPropertiesspring.application.name=demo-es-cqrs-axon

# Configuration H2 pour le Query Side (Projection)
spring.datasource.url=jdbc:h2:mem:demo_es_cqrs_db
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=password
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

server.port=8081

# Configuration de la connexion √† Axon Server
# Doit correspondre au port gRPC (Gateway) d'Axon Server
axon.axonserver.servers=localhost:8124
üíª Instructions de D√©marrageLe projet exige que le serveur Axon soit op√©rationnel avant l'application Spring Boot.√âtape 1 : D√©marrer Axon ServerLocaliser le fichier : Naviguez vers le r√©pertoire contenant axonserver.jar.Lancer le serveur : Ouvrez un terminal et ex√©cutez :Bashjava -jar axonserver.jar
V√©rification : L'interface de surveillance doit √™tre accessible sur : http://localhost:8024.√âtape 2 : D√©marrer l'Application Spring BootOuvrez le projet dans votre IDE.Lancez la classe principale : ma.enset.java.demoescqrsaxon.DemoEsCqrsAxonApplication.V√©rification de la connexion :L'application doit d√©marrer sur le port 8081.La console Axon (http://localhost:8024) doit afficher demo-es-cqrs-axon dans la section Applications.üß™ Tests Fonctionnels (via Swagger UI)Ouvrez l'interface de test : http://localhost:8081/swagger-ui.html.√âtapeOp√©rationEndpointDescriptionSolde Attendu1CommandePOST /commands/accounts/createCr√©er un compte avec 1500 MAD (R√©cup√©rez l'UUID)1500.02CommandePUT /commands/accounts/creditCr√©diter le compte de 500 MAD.2000.03Requ√™teGET /query/accounts/byId/{id}V√©rifier la mise √† jour du solde dans le Query Side.2000.04CommandePUT /commands/accounts/debitD√©biter le compte de 200 MAD.1800.05Requ√™teGET /query/accounts/byId/{id}V√©rifier le solde final.1800.0üìä Visualisation (Axon Console)Utilisez la console pour surveiller le flux d'√©v√©nements :Console Web : http://localhost:8024Event Store : Consultez les √©v√©nements stock√©s pour chaque agr√©gat sous le menu Event Store.
